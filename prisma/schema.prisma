// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String               @id @default(uuid())
  email           String               @unique
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  name            String?
  profileImageUrl String?
  reviews         Review[]
  preferences     UserPreferences?
  recommendations CityRecommendation[]
}

model Review {
  id        String       @id @default(uuid())
  comment   String
  city      CanadianCity
  userId    String
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  user      User         @relation(fields: [userId], references: [id])
}

enum CanadianCity {
  Toronto
  Montreal
  Vancouver
  Calgary
  Edmonton
  Ottawa
  Winnipeg
  Quebec_City
  Hamilton
  Kitchener
  London
  Victoria
  Halifax
  Oshawa
  Windsor
  Saskatoon
  Regina
  St_Johns
  Kelowna
}

enum JobField {
  tech
  finance
  healthcare
  construction
  education
  engineering
  logistics
  retail
  business_admin
  hospitality
  marketing
  legal
  manufacturing
  agriculture
  real_estate
  government
  student
  retired
}

enum CostOfLiving {
  Low
  Medium
  High
}

enum WeatherPreference {
  Cold
  Moderate
  Warm
}

enum Province {
  AB
  BC
  MB
  NB
  NL
  NS
  ON
  PE
  QC
  SK
}

enum LifeStage {
  Student
  Family
  Professional
  Retiree
}

enum LanguagePreference {
  English
  French
  Bilingual
}

enum ImmigrationStatus {
  PR
  Student_Visa
  Work_Permit
  New_Immigrant
}

enum CitySize {
  Small
  Medium
  Large
}

model UserPreferences {
  id                String             @id @default(uuid())
  userId            String             @unique
  jobField          JobField
  costOfLiving      CostOfLiving
  rentalPrice       Int?
  weather           WeatherPreference
  province          Province?
  lifeStage         LifeStage
  language          LanguagePreference
  immigrationStatus ImmigrationStatus
  citySize          CitySize?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([jobField])
  @@index([province])
}

model CityRecommendation {
  id          String   @id @default(uuid())
  userId      String
  city        String
  province    String
  score       Float
  rank        Int
  generatedAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, city])
  @@unique([userId, rank])
  @@index([userId, rank])
}

model CityDetails {
  id                   String   @id @default(uuid())
  city                 String
  province             Province
  slug                 String   @unique
  imageKey             String?
  gallery              Json?
  jobOpportunities     Json?
  costOfLiving         Json?
  weather              Json?
  rent                 Json?
  realEstate           Json?
  qualityOfLife        Json?
  education            Json?
  healthcare           Json?
  communityIntegration Json?
  immigrationSupport   Json?
  safetyCrime          Json?
  transportation       Json?
  internetTech         Json?
  outdoorLifestyle     Json?
  demographics         Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([city, province]) // convenient lookup by name + province
  @@index([province])
}
